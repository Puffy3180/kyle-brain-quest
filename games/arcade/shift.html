<!DOCTYPE html>
<html>
<head>
    <title>Shift</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #2d3436; color: #fff; font-family: 'Space Grotesk', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        #game-container { position: relative; width: 800px; height: 400px; background: #000; border: 2px solid #fff; overflow: hidden; }
        .block { position: absolute; background: #fff; }
        .player { position: absolute; width: 30px; height: 30px; background: #ff7675; transition: transform 0.1s; }
        .exit { position: absolute; width: 40px; height: 40px; background: #55efc4; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #000; }
        .spike { position: absolute; background: #d63031; }
        #ui { margin-bottom: 20px; text-align: center; }
        button { padding: 10px 20px; background: #fff; border: none; font-family: inherit; font-weight: bold; cursor: pointer; margin-top: 10px; }
        h1 { margin: 0; font-size: 40px; }
    </style>
</head>
<body>
    <div id="ui">
        <h1>SHIFT</h1>
        <div id="level-display">LEVEL 1</div>
        <p>SPACE or CLICK to Flip Gravity<br><span style="font-size: 0.8em; color: #aaa;">(R to Restart Level)</span></p>
    </div>

    <div id="game-container">
        <!-- Game Elements Injected Here -->
    </div>

    <a href="../../index.html" style="margin-top: 20px; color: #aaa; text-decoration: none;">Exit</a>

    <script>
        const container = document.getElementById('game-container');
        const levelDisplay = document.getElementById('level-display');
        
        let player = { x: 50, y: 350, w: 30, h: 30, vx: 0, vy: 0, grounded: false, gravity: 0.8, gravityDir: 1 };
        let keys = {};
        let level = 0;
        let blocks = [];
        let spikes = [];
        let exit = { x: 0, y: 0, w: 40, h: 40 };
        let gameRunning = true;
        
        const levels = [
            // Level 1: Basics
            {
                start: {x: 60, y: 300},
                exit: {x: 700, y: 300},
                blocks: [
                    {x: 0, y: 350, w: 800, h: 50}, // Floor
                    {x: 0, y: 0, w: 800, h: 50},   // Ceiling
                    {x: 0, y: 0, w: 50, h: 400},   // Left Wall
                    {x: 750, y: 0, w: 50, h: 400}, // Right Wall
                    {x: 300, y: 200, w: 50, h: 200}, // Obstacle
                    {x: 300, y: 0, w: 50, h: 100}
                ],
                spikes: []
            },
            // Level 2: Spikes
            {
                start: {x: 60, y: 300},
                exit: {x: 700, y: 60},
                blocks: [
                    {x: 0, y: 350, w: 800, h: 50},
                    {x: 0, y: 0, w: 800, h: 50},
                    {x: 0, y: 0, w: 50, h: 400},
                    {x: 750, y: 0, w: 50, h: 400},
                    {x: 200, y: 200, w: 400, h: 50}
                ],
                spikes: [
                    {x: 200, y: 340, w: 400, h: 10} // Floor spikes only - easier to navigate
                ]
            },
            // Level 3: Precision
            {
                start: {x: 60, y: 300},
                exit: {x: 700, y: 300},
                blocks: [
                    {x: 0, y: 350, w: 200, h: 50},
                    {x: 600, y: 350, w: 200, h: 50},
                    {x: 0, y: 0, w: 800, h: 50},
                    {x: 0, y: 0, w: 50, h: 400},
                    {x: 750, y: 0, w: 50, h: 400},
                    {x: 300, y: 150, w: 200, h: 50}
                ],
                spikes: [
                    {x: 200, y: 340, w: 400, h: 10}, // Pit
                    {x: 300, y: 200, w: 200, h: 10}  // Under mid block
                ]
            }
        ];

        function loadLevel(idx) {
            if(idx >= levels.length) {
                alert("YOU BEAT THE GAME!");
                idx = 0;
            }
            level = idx;
            const lvl = levels[level];
            
            player.x = lvl.start.x;
            player.y = lvl.start.y;
            player.vx = 0;
            player.vy = 0;
            player.gravityDir = 1;
            
            exit = { ...lvl.exit, w: 40, h: 40 };
            blocks = lvl.blocks;
            spikes = lvl.spikes;
            
            levelDisplay.textContent = `LEVEL ${level + 1}`;
            drawLevel();
        }

        function drawLevel() {
            container.innerHTML = '';
            
            // Draw Blocks
            blocks.forEach(b => {
                const div = document.createElement('div');
                div.className = 'block';
                div.style.left = b.x + 'px';
                div.style.top = b.y + 'px';
                div.style.width = b.w + 'px';
                div.style.height = b.h + 'px';
                container.appendChild(div);
            });

            // Draw Spikes
            spikes.forEach(s => {
                const div = document.createElement('div');
                div.className = 'spike';
                div.style.left = s.x + 'px';
                div.style.top = s.y + 'px';
                div.style.width = s.w + 'px';
                div.style.height = s.h + 'px';
                container.appendChild(div);
            });

            // Draw Exit
            const exitDiv = document.createElement('div');
            exitDiv.className = 'exit';
            exitDiv.textContent = 'EXIT';
            exitDiv.style.left = exit.x + 'px';
            exitDiv.style.top = exit.y + 'px';
            container.appendChild(exitDiv);

            // Draw Player
            const p = document.createElement('div');
            p.className = 'player';
            p.id = 'player';
            container.appendChild(p);
        }

        function updatePlayerVisuals() {
            const p = document.getElementById('player');
            p.style.left = player.x + 'px';
            p.style.top = player.y + 'px';
        }

        window.addEventListener('keydown', e => {
            if(e.code === 'Space') flipGravity();
            if(e.code === 'KeyR') loadLevel(level);
            keys[e.code] = true;
        });
        window.addEventListener('keyup', e => keys[e.code] = false);
        window.addEventListener('mousedown', flipGravity);

        function flipGravity() {
            if(!gameRunning) return;
            if(player.grounded) { // Only flip if touching ground (makes it a puzzle, not flight)
                player.gravityDir *= -1;
                player.grounded = false;
                player.vy = 2 * player.gravityDir; // Little push off
            }
        }

        function checkRect(r1, r2) {
            return r1.x < r2.x + r2.w &&
                   r1.x + r1.w > r2.x &&
                   r1.y < r2.y + r2.h &&
                   r1.y + r1.h > r2.y;
        }

        function update() {
            if(!gameRunning) return;

            // Horizontal Move
            const speed = 5;
            if(keys['ArrowRight'] || keys['KeyD']) player.vx = speed;
            else if(keys['ArrowLeft'] || keys['KeyA']) player.vx = -speed;
            else player.vx = 0;

            player.x += player.vx;

            // Horizontal Collision
            player.grounded = false; // Reset grounded check
            for(let b of blocks) {
                if(checkRect(player, b)) {
                    if(player.vx > 0) player.x = b.x - player.w;
                    else if(player.vx < 0) player.x = b.x + b.w;
                    player.vx = 0;
                }
            }

            // Vertical Move
            player.vy += player.gravity * player.gravityDir;
            player.y += player.vy;

            // Vertical Collision
            for(let b of blocks) {
                if(checkRect(player, b)) {
                    if(player.vy > 0) { // Falling down
                        player.y = b.y - player.h;
                        player.grounded = (player.gravityDir === 1);
                    } else if (player.vy < 0) { // Falling up
                        player.y = b.y + b.h;
                        player.grounded = (player.gravityDir === -1);
                    }
                    player.vy = 0;
                }
            }

            // Spike Collision
            for(let s of spikes) {
                if(checkRect(player, s)) {
                    loadLevel(level); // Die
                    return;
                }
            }

            // Exit Collision
            if(checkRect(player, exit)) {
                loadLevel(level + 1);
                return;
            }

            // Out of bounds
            if(player.y > 600 || player.y < -200) loadLevel(level);

            updatePlayerVisuals();
            requestAnimationFrame(update);
        }

        loadLevel(0);
        update();

    </script>
</body>
</html>

