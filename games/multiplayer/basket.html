<!DOCTYPE html>
<html>
<head>
    <title>Basket Battle (2P)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #f39c12; color: #fff; font-family: 'Space Grotesk', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        canvas { background: #fff; border: 4px solid #d35400; }
        .ui { position: absolute; top: 20px; width: 100%; display: flex; justify-content: center; gap: 50px; font-size: 1.5rem; pointer-events: none; color: #333; }
        .back-btn { position: absolute; bottom: 20px; color: #fff; text-decoration: none; pointer-events: auto; }
    </style>
</head>
<body>
    <div class="ui">
        <div style="color: #2980b9">P1: WASD</div>
        <div style="color: #c0392b">P2: ARROWS</div>
    </div>
    
    <canvas id="game" width="800" height="500"></canvas>
    <a href="../../index.html" class="back-btn">Time Out</a>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');

        const keys = {};
        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);

        // Hoops
        const hoop1 = { x: 60, y: 200, r: 25 }; // Left Hoop (Score here for P2)
        const hoop2 = { x: 740, y: 200, r: 25 }; // Right Hoop (Score here for P1)

        // Players
        const p1 = { x: 200, y: 450, vx: 0, vy: 0, color: '#2980b9', score: 0, holding: false };
        const p2 = { x: 600, y: 450, vx: 0, vy: 0, color: '#c0392b', score: 0, holding: false };
        const gravity = 0.5;
        const jumpForce = -12;
        const speed = 0.5;

        // Ball
        const ball = { x: 400, y: 200, vx: 0, vy: 0, r: 12, owner: null };

        function update() {
            // P1 Controls
            if(keys['KeyA']) p1.vx -= speed;
            if(keys['KeyD']) p1.vx += speed;
            if(keys['KeyW'] && p1.grounded) { p1.vy = jumpForce; p1.grounded = false; }
            if(keys['Space']) { // Shoot / Steal
                if (p1.holding) shoot(p1, 1); // Shoot right
                else trySteal(p1, p2);
            }

            // P2 Controls
            if(keys['ArrowLeft']) p2.vx -= speed;
            if(keys['ArrowRight']) p2.vx += speed;
            if(keys['ArrowUp'] && p2.grounded) { p2.vy = jumpForce; p2.grounded = false; }
            if(keys['Enter']) {
                if (p2.holding) shoot(p2, -1); // Shoot left
                else trySteal(p2, p1);
            }

            [p1, p2].forEach(p => {
                p.vy += gravity;
                p.x += p.vx;
                p.y += p.vy;
                p.vx *= 0.9; // Friction

                // Floor
                if(p.y > 480) { p.y = 480; p.vy = 0; p.grounded = true; }
                // Walls
                if(p.x < 20) p.x = 20;
                if(p.x > 780) p.x = 780;
            });

            // Ball Physics
            if (ball.owner) {
                ball.x = ball.owner.x;
                ball.y = ball.owner.y - 30;
                ball.vx = ball.owner.vx;
                ball.vy = ball.owner.vy;
            } else {
                ball.vy += gravity * 0.5;
                ball.x += ball.vx;
                ball.y += ball.vy;
                ball.vx *= 0.99;

                // Bounce floor/walls
                if(ball.y > 485) { ball.y = 485; ball.vy *= -0.8; }
                if(ball.x < 10 || ball.x > 790) ball.vx *= -0.8;

                // Pickup
                [p1, p2].forEach(p => {
                    if(Math.hypot(ball.x - p.x, ball.y - p.y) < 30) {
                        ball.owner = p;
                        p.holding = true;
                    }
                });
            }

            // Hoop Logic
            checkHoop(hoop2, p1); // P1 shoots right
            checkHoop(hoop1, p2); // P2 shoots left
        }

        function shoot(p, dir) {
            p.holding = false;
            ball.owner = null;
            ball.vx = 10 * dir + p.vx;
            ball.vy = -10 + p.vy;
        }

        function trySteal(thief, victim) {
            if (victim.holding && Math.hypot(thief.x - victim.x, thief.y - victim.y) < 40) {
                victim.holding = false;
                ball.owner = thief;
                thief.holding = true;
                // Pop ball up slightly
                ball.vy = -5;
            }
        }

        function checkHoop(hoop, scorer) {
            // Check if ball passes through hoop from top
            if (Math.hypot(ball.x - hoop.x, ball.y - hoop.y) < hoop.r) {
                scorer.score++;
                reset();
            }
        }

        function reset() {
            ball.owner = null;
            p1.holding = false; p2.holding = false;
            ball.x = 400; ball.y = 200; ball.vx = 0; ball.vy = 0;
            p1.x = 200; p1.y = 450;
            p2.x = 600; p2.y = 450;
        }

        function draw() {
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Hoops
            ctx.strokeStyle = '#e67e22';
            ctx.lineWidth = 5;
            [hoop1, hoop2].forEach(h => {
                ctx.beginPath();
                ctx.arc(h.x, h.y, h.r, 0, Math.PI, false); // Half circle
                ctx.stroke();
            });

            // Players
            [p1, p2].forEach(p => {
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x-15, p.y-40, 30, 40);
            });

            // Ball
            ctx.fillStyle = '#d35400';
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
            ctx.fill();

            // Scores
            ctx.fillStyle = '#333';
            ctx.font = "40px Space Grotesk";
            ctx.fillText(p1.score, 300, 50);
            ctx.fillText(p2.score, 470, 50);
        }

        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        loop();

    </script>
</body>
</html>
