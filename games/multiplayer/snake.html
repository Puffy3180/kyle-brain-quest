<!DOCTYPE html>
<html>
<head>
    <title>Snake Battle (2P)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #2d3436; color: #fff; font-family: 'Space Grotesk', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        canvas { background: #000; border: 4px solid #636e72; }
        .ui { position: absolute; top: 20px; width: 100%; display: flex; justify-content: center; gap: 50px; font-size: 1.5rem; pointer-events: none; }
        .back-btn { position: absolute; bottom: 20px; color: #aaa; text-decoration: none; pointer-events: auto; }
        #winner { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 4rem; display: none; z-index: 10; text-shadow: 0 0 10px #000; }
    </style>
</head>
<body>
    <div class="ui">
        <div style="color: #00b894">P1: WASD</div>
        <div style="color: #0984e3">P2: ARROWS</div>
    </div>
    <h1 id="winner">P1 WINS!</h1>
    <canvas id="game" width="800" height="600"></canvas>
    <a href="../../index.html" class="back-btn">Exit Pit</a>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const winnerEl = document.getElementById('winner');

        const SIZE = 20; // Grid size
        const w = canvas.width / SIZE;
        const h = canvas.height / SIZE;

        let p1 = { body: [{x: 5, y: 10}], dx: 1, dy: 0, color: '#00b894', nextDx: 1, nextDy: 0, score: 0, alive: true };
        let p2 = { body: [{x: 35, y: 10}], dx: -1, dy: 0, color: '#0984e3', nextDx: -1, nextDy: 0, score: 0, alive: true };
        let food = { x: 20, y: 10 };
        let running = true;

        document.addEventListener('keydown', e => {
            // P1
            if (e.code === 'KeyW' && p1.dy === 0) { p1.nextDx = 0; p1.nextDy = -1; }
            if (e.code === 'KeyS' && p1.dy === 0) { p1.nextDx = 0; p1.nextDy = 1; }
            if (e.code === 'KeyA' && p1.dx === 0) { p1.nextDx = -1; p1.nextDy = 0; }
            if (e.code === 'KeyD' && p1.dx === 0) { p1.nextDx = 1; p1.nextDy = 0; }

            // P2
            if (e.code === 'ArrowUp' && p2.dy === 0) { p2.nextDx = 0; p2.nextDy = -1; }
            if (e.code === 'ArrowDown' && p2.dy === 0) { p2.nextDx = 0; p2.nextDy = 1; }
            if (e.code === 'ArrowLeft' && p2.dx === 0) { p2.nextDx = -1; p2.nextDy = 0; }
            if (e.code === 'ArrowRight' && p2.dx === 0) { p2.nextDx = 1; p2.nextDy = 0; }
            
            if (!running && e.code === 'Space') resetGame();
        });

        function spawnFood() {
            let safe = false;
            while (!safe) {
                food.x = Math.floor(Math.random() * w);
                food.y = Math.floor(Math.random() * h);
                safe = true;
                // Check collision with bodies
                [p1, p2].forEach(p => {
                    p.body.forEach(s => {
                        if (s.x === food.x && s.y === food.y) safe = false;
                    });
                });
            }
        }

        function resetGame() {
            p1.body = [{x: 5, y: 15}, {x:4, y:15}, {x:3, y:15}];
            p1.dx = 1; p1.dy = 0; p1.nextDx = 1; p1.nextDy = 0; p1.alive = true;

            p2.body = [{x: 35, y: 15}, {x:36, y:15}, {x:37, y:15}];
            p2.dx = -1; p2.dy = 0; p2.nextDx = -1; p2.nextDy = 0; p2.alive = true;

            spawnFood();
            running = true;
            winnerEl.style.display = 'none';
        }

        function gameOver(winner) {
            running = false;
            winnerEl.innerText = winner + " WINS!";
            winnerEl.style.display = 'block';
            if (winner === "P1") p1.score++;
            if (winner === "P2") p2.score++;
        }

        function updateSnake(p) {
            if (!p.alive) return;
            p.dx = p.nextDx;
            p.dy = p.nextDy;

            const head = { x: p.body[0].x + p.dx, y: p.body[0].y + p.dy };
            
            // Wall Collision (Die)
            if (head.x < 0 || head.x >= w || head.y < 0 || head.y >= h) {
                p.alive = false;
                return;
            }

            // Self Collision
            for (let s of p.body) {
                if (head.x === s.x && head.y === s.y) p.alive = false;
            }

            p.body.unshift(head);
            
            // Food
            if (head.x === food.x && head.y === food.y) {
                spawnFood();
            } else {
                p.body.pop();
            }
        }

        function checkCollisions() {
            // Head to Head
            if (p1.body[0].x === p2.body[0].x && p1.body[0].y === p2.body[0].y) {
                p1.alive = false;
                p2.alive = false;
            }

            // Head to Other Body
            // P1 Head vs P2 Body
            for (let s of p2.body) {
                if (p1.body[0].x === s.x && p1.body[0].y === s.y) p1.alive = false;
            }
            // P2 Head vs P1 Body
            for (let s of p1.body) {
                if (p2.body[0].x === s.x && p2.body[0].y === s.y) p2.alive = false;
            }
        }

        function update() {
            if (!running) return;

            updateSnake(p1);
            updateSnake(p2);
            checkCollisions();

            if (!p1.alive && !p2.alive) gameOver("DRAW");
            else if (!p1.alive) gameOver("P2");
            else if (!p2.alive) gameOver("P1");
        }

        function draw() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Food
            ctx.fillStyle = '#ff7675';
            ctx.fillRect(food.x * SIZE, food.y * SIZE, SIZE, SIZE);

            // P1
            ctx.fillStyle = p1.color;
            p1.body.forEach(s => ctx.fillRect(s.x * SIZE, s.y * SIZE, SIZE-1, SIZE-1));

            // P2
            ctx.fillStyle = p2.color;
            p2.body.forEach(s => ctx.fillRect(s.x * SIZE, s.y * SIZE, SIZE-1, SIZE-1));

            // Scores
            ctx.fillStyle = '#fff';
            ctx.font = "20px Space Grotesk";
            ctx.fillText(p1.score, 20, 30);
            ctx.fillText(p2.score, 760, 30);
        }

        resetGame();
        // Slower update loop for Snake feel (15 FPS)
        setInterval(() => {
            update();
            draw();
        }, 1000/15);

    </script>
</body>
</html>
