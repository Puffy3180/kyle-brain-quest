<!DOCTYPE html>
<html>
<head>
    <title>Micro Soccer (2P)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #2f3542; color: #fff; font-family: 'Space Grotesk', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        canvas { background: #27ae60; border: 4px solid #fff; }
        .back-btn { position: absolute; bottom: 20px; color: #fff; text-decoration: none; }
    </style>
</head>
<body>
    <canvas id="game" width="800" height="500"></canvas>
    <a href="../../index.html" class="back-btn">Leave Pitch</a>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');

        const keys = {};
        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);

        const ball = { x: 400, y: 250, r: 10, vx: 0, vy: 0, friction: 0.98 };
        const p1 = { x: 100, y: 250, r: 20, color: '#e74c3c', vx: 0, vy: 0, score: 0 };
        const p2 = { x: 700, y: 250, r: 20, color: '#3498db', vx: 0, vy: 0, score: 0 };
        const goalH = 150;

        function update() {
            // P1
            if(keys['KeyW']) p1.vy -= 0.5;
            if(keys['KeyS']) p1.vy += 0.5;
            if(keys['KeyA']) p1.vx -= 0.5;
            if(keys['KeyD']) p1.vx += 0.5;

            // P2
            if(keys['ArrowUp']) p2.vy -= 0.5;
            if(keys['ArrowDown']) p2.vy += 0.5;
            if(keys['ArrowLeft']) p2.vx -= 0.5;
            if(keys['ArrowRight']) p2.vx += 0.5;

            [p1, p2].forEach(p => {
                p.x += p.vx; p.y += p.vy;
                p.vx *= 0.9; p.vy *= 0.9;
                
                // Bounds
                p.x = Math.max(p.r, Math.min(canvas.width - p.r, p.x));
                p.y = Math.max(p.r, Math.min(canvas.height - p.r, p.y));

                // Ball Collision
                const dx = ball.x - p.x;
                const dy = ball.y - p.y;
                const dist = Math.hypot(dx, dy);
                if (dist < p.r + ball.r) {
                    const angle = Math.atan2(dy, dx);
                    const force = Math.hypot(p.vx, p.vy) + 1; // Add kick force
                    
                    ball.vx += Math.cos(angle) * force * 2;
                    ball.vy += Math.sin(angle) * force * 2;
                    
                    // Push ball out
                    const overlap = p.r + ball.r - dist;
                    ball.x += Math.cos(angle) * overlap;
                    ball.y += Math.sin(angle) * overlap;
                }
            });

            // Ball Physics
            ball.x += ball.vx;
            ball.y += ball.vy;
            ball.vx *= ball.friction;
            ball.vy *= ball.friction;

            // Wall Bounce
            if (ball.y < ball.r || ball.y > canvas.height - ball.r) ball.vy *= -1;
            if (ball.x < ball.r) {
                if (ball.y > (canvas.height - goalH)/2 && ball.y < (canvas.height + goalH)/2) {
                    p2.score++; reset();
                } else {
                    ball.vx *= -1;
                }
            }
            if (ball.x > canvas.width - ball.r) {
                if (ball.y > (canvas.height - goalH)/2 && ball.y < (canvas.height + goalH)/2) {
                    p1.score++; reset();
                } else {
                    ball.vx *= -1;
                }
            }
        }

        function reset() {
            ball.x = 400; ball.y = 250; ball.vx = 0; ball.vy = 0;
            p1.x = 100; p1.y = 250; p1.vx = 0; p1.vy = 0;
            p2.x = 700; p2.y = 250; p2.vx = 0; p2.vy = 0;
        }

        function draw() {
            ctx.fillStyle = '#27ae60';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Field Lines
            ctx.strokeStyle = 'rgba(255,255,255,0.5)';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(400, 0); ctx.lineTo(400, 500); // Center
            ctx.stroke();
            ctx.beginPath(); ctx.arc(400, 250, 50, 0, Math.PI*2); ctx.stroke(); // Circle

            // Goals
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.fillRect(0, (canvas.height-goalH)/2, 20, goalH);
            ctx.fillRect(canvas.width-20, (canvas.height-goalH)/2, 20, goalH);

            // Players
            [p1, p2].forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
                ctx.fillStyle = p.color;
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
            });

            // Ball
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
            ctx.fillStyle = '#fff';
            ctx.fill();

            // Scores
            ctx.font = "50px Space Grotesk";
            ctx.fillStyle = 'rgba(255,255,255,0.8)';
            ctx.fillText(p1.score, 300, 60);
            ctx.fillText(p2.score, 470, 60);
        }

        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        loop();
    </script>
</body>
</html>
