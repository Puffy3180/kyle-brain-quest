<!DOCTYPE html>
<html>
<head>
    <title>Sumo Smash (2P)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #2d3436; color: #fff; font-family: 'Space Grotesk', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        canvas { background: #dfe6e9; border-radius: 50%; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        .ui { position: absolute; top: 20px; width: 100%; display: flex; justify-content: center; gap: 50px; font-size: 1.5rem; pointer-events: none; }
        .back-btn { position: absolute; bottom: 20px; color: #aaa; text-decoration: none; pointer-events: auto; }
        #winner { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 4rem; display: none; text-shadow: 0 0 20px #000; z-index: 10; }
    </style>
</head>
<body>
    <div class="ui">
        <div style="color: #d63031">P1: WASD</div>
        <div style="color: #0984e3">P2: ARROWS</div>
    </div>
    
    <h1 id="winner">P1 WINS</h1>
    <canvas id="game" width="600" height="600"></canvas>
    
    <a href="../../index.html" class="back-btn">Exit Dojo</a>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const winnerEl = document.getElementById('winner');

        const radius = canvas.width / 2;
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        let running = true;
        const keys = {};

        class Player {
            constructor(x, y, color, controls) {
                this.x = x;
                this.y = y;
                this.r = 20;
                this.vx = 0;
                this.vy = 0;
                this.color = color;
                this.controls = controls;
                this.mass = 1;
                this.speed = 0.5;
                this.friction = 0.95;
            }

            update() {
                if (!running) return;

                // Input
                if (keys[this.controls.up]) this.vy -= this.speed;
                if (keys[this.controls.down]) this.vy += this.speed;
                if (keys[this.controls.left]) this.vx -= this.speed;
                if (keys[this.controls.right]) this.vx += this.speed;

                // Physics
                this.x += this.vx;
                this.y += this.vy;
                this.vx *= this.friction;
                this.vy *= this.friction;

                // Check Ring Out
                const dist = Math.hypot(this.x - centerX, this.y - centerY);
                if (dist > radius - this.r) {
                    gameOver(this === p1 ? "P2" : "P1");
                }
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
        }

        const p1 = new Player(centerX - 100, centerY, '#d63031', { up: 'KeyW', down: 'KeyS', left: 'KeyA', right: 'KeyD' });
        const p2 = new Player(centerX + 100, centerY, '#0984e3', { up: 'ArrowUp', down: 'ArrowDown', left: 'ArrowLeft', right: 'ArrowRight' });

        document.addEventListener('keydown', e => {
            keys[e.code] = true;
            if (!running && e.code === 'Space') resetGame();
        });
        document.addEventListener('keyup', e => keys[e.code] = false);

        function checkCollision() {
            const dx = p2.x - p1.x;
            const dy = p2.y - p1.y;
            const dist = Math.hypot(dx, dy);

            if (dist < p1.r + p2.r) {
                // Elastic Collision
                const angle = Math.atan2(dy, dx);
                const sin = Math.sin(angle);
                const cos = Math.cos(angle);

                // Rotate velocity
                const v1 = { x: 0, y: 0 };
                const v2 = { x: 0, y: 0 }; // Relative velocities... let's simplify.
                
                // Simple bounce: Swap momentum roughly + push out
                const overlap = (p1.r + p2.r - dist) / 2;
                p1.x -= overlap * cos;
                p1.y -= overlap * sin;
                p2.x += overlap * cos;
                p2.y += overlap * sin;

                // Bounce Effect
                const force = 1.5;
                p1.vx -= cos * force;
                p1.vy -= sin * force;
                p2.vx += cos * force;
                p2.vy += sin * force;
            }
        }

        function resetGame() {
            p1.x = centerX - 100; p1.y = centerY; p1.vx = 0; p1.vy = 0;
            p2.x = centerX + 100; p2.y = centerY; p2.vx = 0; p2.vy = 0;
            running = true;
            winnerEl.style.display = 'none';
        }

        function gameOver(winner) {
            running = false;
            winnerEl.innerText = winner + " WINS!";
            winnerEl.style.display = 'block';
        }

        function update() {
            p1.update();
            p2.update();
            checkCollision();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw Ring
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius - 5, 0, Math.PI * 2);
            ctx.fillStyle = '#b2bec3';
            ctx.fill();
            ctx.strokeStyle = '#d63031'; // Danger zone
            ctx.lineWidth = 10;
            ctx.stroke();

            p1.draw();
            p2.draw();
        }

        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        loop();

    </script>
</body>
</html>
