<!DOCTYPE html>
<html>
<head>
    <title>Pixel Tag (2P)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #222; color: #fff; font-family: 'Space Grotesk', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        canvas { background: #333; }
        .ui { position: absolute; top: 20px; width: 100%; display: flex; justify-content: center; gap: 50px; font-size: 1.5rem; pointer-events: none; }
        .back-btn { position: absolute; bottom: 20px; color: #aaa; text-decoration: none; pointer-events: auto; }
    </style>
</head>
<body>
    <div class="ui">
        <div style="color: #ff9f43">P1: WASD</div>
        <div style="color: #54a0ff">P2: ARROWS</div>
    </div>
    
    <canvas id="game" width="800" height="600"></canvas>
    
    <a href="../../index.html" class="back-btn">Stop Running</a>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');

        const keys = {};
        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);

        let p1 = { x: 100, y: 300, w: 30, h: 30, color: '#ff9f43', it: true };
        let p2 = { x: 700, y: 300, w: 30, h: 30, color: '#54a0ff', it: false };
        
        let p1Time = 0;
        let p2Time = 0;
        let lastTagTime = 0;

        function update() {
            const speed = 5;
            // P1
            if(keys['KeyW']) p1.y -= speed;
            if(keys['KeyS']) p1.y += speed;
            if(keys['KeyA']) p1.x -= speed;
            if(keys['KeyD']) p1.x += speed;

            // P2
            if(keys['ArrowUp']) p2.y -= speed;
            if(keys['ArrowDown']) p2.y += speed;
            if(keys['ArrowLeft']) p2.x -= speed;
            if(keys['ArrowRight']) p2.x += speed;

            // Bounds
            [p1, p2].forEach(p => {
                p.x = Math.max(0, Math.min(canvas.width - p.w, p.x));
                p.y = Math.max(0, Math.min(canvas.height - p.h, p.y));
            });

            // Tag Logic
            if (Date.now() - lastTagTime > 1000) { // 1 second cooldown
                if (checkCollision(p1, p2)) {
                    p1.it = !p1.it;
                    p2.it = !p2.it;
                    lastTagTime = Date.now();
                }
            }

            // Timers
            if (!p1.it) p1Time++; // Score goes up if NOT IT
            if (!p2.it) p2Time++;
        }

        function checkCollision(r1, r2) {
            return r1.x < r2.x + r2.w &&
                   r1.x + r1.w > r2.x &&
                   r1.y < r2.y + r2.h &&
                   r1.y + r1.h > r2.y;
        }

        function draw() {
            ctx.fillStyle = '#222';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw Players
            ctx.fillStyle = p1.it ? '#ff0000' : p1.color; // IT is red
            if(p1.it) ctx.shadowBlur = 20; ctx.shadowColor = 'red';
            ctx.fillRect(p1.x, p1.y, p1.w, p1.h);
            ctx.shadowBlur = 0;

            ctx.fillStyle = p2.it ? '#ff0000' : p2.color;
            if(p2.it) ctx.shadowBlur = 20; ctx.shadowColor = 'red';
            ctx.fillRect(p2.x, p2.y, p2.w, p2.h);
            ctx.shadowBlur = 0;

            // Draw "IT" Text
            ctx.fillStyle = '#fff';
            ctx.font = "20px Space Grotesk";
            if(p1.it) ctx.fillText("IT!", p1.x, p1.y - 10);
            if(p2.it) ctx.fillText("IT!", p2.x, p2.y - 10);

            // Draw Scores (Time survived)
            ctx.fillText("P1: " + Math.floor(p1Time/60) + "s", 50, 50);
            ctx.fillText("P2: " + Math.floor(p2Time/60) + "s", 650, 50);
        }

        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        loop();

    </script>
</body>
</html>
