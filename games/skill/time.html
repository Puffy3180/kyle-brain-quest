<!DOCTYPE html>
<html>
<head>
    <title>Time Shift</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #fff; color: #000; font-family: 'Space Grotesk', sans-serif; cursor: none; }
        canvas { display: block; }
        #ui {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: none;
            z-index: 10;
        }
        h1 { font-size: 4rem; margin: 0; text-transform: uppercase; letter-spacing: 10px; }
        p { font-size: 1.5rem; color: #555; }
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: transparent;
            color: #000;
            border: 1px solid #000;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 20px;
            font-weight: bold;
            z-index: 100;
            pointer-events: auto;
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="location.href='../../index.html'">‚Üê Back</button>

    <div id="ui">
        <h1 id="title">TIME SHIFT</h1>
        <p id="msg">TIME MOVES WHEN YOU MOVE</p>
        <p id="score">Score: 0</p>
    </div>

    <canvas id="game"></canvas>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const ui = document.getElementById('ui');
        const title = document.getElementById('title');
        const msg = document.getElementById('msg');
        const scoreEl = document.getElementById('score');

        let width, height;
        let player = { x: 0, y: 0, r: 10, alive: false };
        let bullets = [];
        let score = 0;
        let lastMouse = { x: 0, y: 0 };
        let timeFactor = 0;

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            if(!player.alive) {
                player.x = width/2;
                player.y = height/2;
            }
        }
        window.addEventListener('resize', resize);

        window.addEventListener('mousemove', e => {
            if(player.alive) {
                // Calc movement distance
                const dx = e.clientX - lastMouse.x;
                const dy = e.clientY - lastMouse.y;
                const dist = Math.hypot(dx, dy);
                
                // Time moves based on mouse speed
                // Clamp it so you can't just jitter
                timeFactor = Math.min(dist * 0.05, 1.0); 
                
                player.x = e.clientX;
                player.y = e.clientY;
                
                lastMouse.x = e.clientX;
                lastMouse.y = e.clientY;
            } else {
                lastMouse.x = e.clientX;
                lastMouse.y = e.clientY;
            }
        });
        
        window.addEventListener('click', () => {
            if(!player.alive) startGame();
        });

        function startGame() {
            player.alive = true;
            player.x = width/2;
            player.y = height/2;
            bullets = [];
            score = 0;
            title.style.display = 'none';
            msg.style.display = 'none';
        }

        function gameOver() {
            player.alive = false;
            title.style.display = 'block';
            title.innerText = "SHATTERED";
            msg.style.display = 'block';
            msg.innerText = "Click to Restart";
        }

        function spawnBullet() {
            // Spawn from edges
            const side = Math.floor(Math.random() * 4);
            let x, y, vx, vy;
            const speed = 8 + Math.random() * 8; // Faster bullets

            if(side === 0) { x = Math.random()*width; y = -10; }
            else if(side === 1) { x = width+10; y = Math.random()*height; }
            else if(side === 2) { x = Math.random()*width; y = height+10; }
            else { x = -10; y = Math.random()*height; }

            // Aim at player
            const angle = Math.atan2(player.y - y, player.x - x);
            vx = Math.cos(angle) * speed;
            vy = Math.sin(angle) * speed;

            bullets.push({ x, y, vx, vy, r: 5 });
        }

        function update() {
            // Decay time factor naturally
            timeFactor *= 0.9;
            if(timeFactor < 0.05) timeFactor = 0;

            if(!player.alive) return;

            // Bullet logic
            if(timeFactor > 0) {
                // Move bullets
                bullets.forEach(b => {
                    b.x += b.vx * timeFactor;
                    b.y += b.vy * timeFactor;
                });

                // Spawn bullets based on movement
                // More movement = more bullets? 
                // Actually, standard spawn rate but time factor applies to spawn timer?
                // Let's just spawn randomly but update chance based on time.
                if(Math.random() < 0.08 * timeFactor) { // Increased spawn rate
                    spawnBullet();
                }
            }

            // Cleanup bullets
            bullets = bullets.filter(b => b.x > -50 && b.x < width+50 && b.y > -50 && b.y < height+50);

            // Collisions
            for(let b of bullets) {
                const dx = player.x - b.x;
                const dy = player.y - b.y;
                if(dx*dx + dy*dy < (player.r + b.r)**2) {
                    gameOver();
                }
            }
            
            score++;
            scoreEl.innerText = score;
        }

        function draw() {
            ctx.clearRect(0, 0, width, height);
            
            // Background based on timeFactor
            // Flash red/black when time moves
            // ctx.fillStyle = `rgba(255, 0, 0, ${timeFactor * 0.1})`;
            // ctx.fillRect(0,0,width,height);

            // Draw Bullets
            ctx.fillStyle = '#000';
            ctx.beginPath();
            bullets.forEach(b => {
                ctx.moveTo(b.x + b.r, b.y);
                ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
                
                // Trail
                if(timeFactor > 0.1) {
                    ctx.moveTo(b.x, b.y);
                    ctx.lineTo(b.x - b.vx*5, b.y - b.vy*5);
                }
            });
            ctx.fill();
            ctx.stroke(); // Draw trails

            // Draw Player
            ctx.fillStyle = '#ff0000';
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.r, 0, Math.PI*2);
            ctx.fill();
        }

        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        resize();
        loop();

    </script>
</body>
</html>
